<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Linyao Li - Scalability Rules</title>
  <meta name="author" content="Linyao Li" />
  <meta name="description" content="The blog of Linyao Li" />
  <link rel="canonical" href="http://example.com/2017/04/06/scalability-rules.html" />

  <link href="//fonts.googleapis.com/css?family=Open+Sans:600,800" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="/favicon.png">
  <link rel="alternate" type="application/atom+xml" title="Linyao Li" href="http://example.com/atom.xml" />

  <link rel="stylesheet" href="/assets/css/all.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha256-k2/8zcNbxVIh5mnQ52A0r3a6jAgMGxFJFE2707UxGCk= sha512-ZV9KawG2Legkwp3nAlxLIVFudTauWuBpC10uEafMHYL0Sarrz5A7G79kXh5+5+woxQ5HM559XX2UZjMJ36Wplg==" crossorigin="anonymous">
</head>
<body>
  <div class="container">
    <div class="four columns sidebar">
      <nav>
  <h1>Hi.</h1>
  <a href="/">
    
    <img src="http://www.gravatar.com/avatar/62922313da538f31d1760fdf4505c5d6?s=200" id="gravatar" alt="My photo"/>
    
  </a>
  <h2>I'm <a href="/">Linyao Li</a>.</h2>
  <div id="bio">
  </div>
  <div id="social">
    Follow me:
<div id="stalker">
  
  <a title="lileeyao on Github" href="https://github.com/lileeyao">
    <i class="fa fa-github-square"></i>
  </a>
  

  

  

  

  

  

  

  

  

  

  

  
</div>

  </div>
</nav>

    </div>

    <div class="eleven columns content">
      <p class="meta">
  April 06, 2017 
  <a href="/">
    <i class="home fa fa-home"></i>
  </a>
</p>

<h1 class="title">Scalability Rules</h1>

<div id="post">
  <p>This post is a note/headline for reading book Scalability Rules, so in the future I can look back
to this rather than finding the book. If you find this interesting, go search <a href="https://www.amazon.com/s/ref=nb_sb_noss_2?url=search-alias%3Daps&amp;field-keywords=scalability+rules">Scalability Rules</a>. Great book.</p>

<p>Before all of these below, please devote to the bible of scalable system <a href="https://en.wikipedia.org/wiki/CAP_theorem">CAP</a>.</p>

<hr />
<ul id="markdown-toc">
  <li><a href="#i-reduce-the-equation" id="markdown-toc-i-reduce-the-equation">I. Reduce the equation</a></li>
  <li><a href="#ii-distribute-the-work" id="markdown-toc-ii-distribute-the-work">II. Distribute the work</a></li>
  <li><a href="#iii-design-to-scale-out-horizontally" id="markdown-toc-iii-design-to-scale-out-horizontally">III. Design to scale out horizontally</a></li>
  <li><a href="#iv-use-the-right-tools" id="markdown-toc-iv-use-the-right-tools">IV. Use the right tools</a></li>
  <li><a href="#v-dont-duplicate-your-work" id="markdown-toc-v-dont-duplicate-your-work">V. Don’t duplicate your work</a></li>
  <li><a href="#vi-use-caching-aggressively-damn-i-love-it" id="markdown-toc-vi-use-caching-aggressively-damn-i-love-it">VI. Use caching aggressively. Damn I love it.</a></li>
  <li><a href="#vii-learn-from-mistakes" id="markdown-toc-vii-learn-from-mistakes">VII. Learn from mistakes</a></li>
  <li><a href="#viii-database-rules" id="markdown-toc-viii-database-rules">VIII. Database rules</a></li>
  <li><a href="#ix-design-for-fault-tolerance-and-graceful-failure" id="markdown-toc-ix-design-for-fault-tolerance-and-graceful-failure">IX. Design for fault tolerance and graceful failure</a></li>
  <li><a href="#x-avoid-or-distribute-state" id="markdown-toc-x-avoid-or-distribute-state">X. Avoid or distribute state.</a></li>
  <li><a href="#xi-asynchronous-communication-and-message-buses" id="markdown-toc-xi-asynchronous-communication-and-message-buses">XI. Asynchronous communication and message buses.</a></li>
  <li><a href="#xii-miscellaneous-rules" id="markdown-toc-xii-miscellaneous-rules">XII. Miscellaneous rules</a></li>
</ul>

<h2 id="i-reduce-the-equation">I. Reduce the equation</h2>
<ol>
  <li>Don’t overengineer the solution. Complex systems result in costly effort and maintaince, decompose complex requiments into smaller systems, and make them sharable and reusable.</li>
  <li>Design scale into solution. Design to 20x capacity, implemenet for 3x capacity, deploy for ~1.5x capacity.</li>
  <li>Simply the solution 3 times over(Pareto Principle). This falls into the Rule(1), but remember simplification is not necessarily considered as always good.</li>
  <li>Reduce DNS lookups.</li>
  <li>Reduce objects where possible. Frontend stuffs.</li>
  <li>Use homogenous networks. Hardware.</li>
</ol>

<h2 id="ii-distribute-the-work">II. Distribute the work</h2>
<p><img src="https://ranjithabalaraman.files.wordpress.com/2014/10/scaledb.png" alt="three axes of scale" /></p>
<ol>
  <li>Design to clone things(x-axis). Or horizontal scalability, essentially the duplication of services. This is the most important ideology in scalability I’d say.
    <ul>
      <li>For services, ensure it is logically simple(use standardized interface e.g. RESTful/RPC) and easy to clone, use load balancer.</li>
      <li>For databases, normally used when Read » Write. Master-Slave / Consistent Hashing etc. note <a href="https://en.wikipedia.org/wiki/ACID">ACID</a></li>
    </ul>
  </li>
  <li>Design to split different things(y-axis). Which I don’t care much.</li>
  <li>Design to split similar things(z-axis). ..Either.</li>
</ol>

<h2 id="iii-design-to-scale-out-horizontally">III. Design to scale out horizontally</h2>
<ol>
  <li>Design your solution to scale out, not just up.
    <ul>
      <li>Scaling out means the replication of services.</li>
      <li>Scaling up means upgrade of computing resources.
  This is really just a duplicate from Rule(7). meh.</li>
    </ul>
  </li>
  <li>Use commodiity systems. Be cost-effective.</li>
  <li>Scale out your data centers. This is more of a concern on availability and failover, so always prepare for multiple data centers. Models may vary.</li>
  <li>Design to leverage the cloud. e.g store unimportant files in S3 (I will never save important data in S3).</li>
</ol>

<h2 id="iv-use-the-right-tools">IV. Use the right tools</h2>
<ol>
  <li>Use databases appropriately.
    <ul>
      <li>Use RDBMS for cross-table lookup. e.g. MySQL.</li>
      <li>Use NoSQL for simple R/W key-value queries. e.g. for great scalability, Cassandra; for grete <a href="https://en.wikipedia.org/wiki/Conflict-free_replicated_data_type">CRDT</a> support, Riak; for light weight, LevelDB. There are tons of options, the world of database is heaven.</li>
    </ul>
  </li>
  <li>Don’t abusively use firewalls, it makes network slow. Put firewall only in critical path.</li>
  <li>It is never too less for logging. Use reliable and fast tool such as <a href="https://github.com/zendesk/maxwell">Maxwell</a> for aggregation, and make it well rotated.</li>
</ol>

<h2 id="v-dont-duplicate-your-work">V. Don’t duplicate your work</h2>
<ol>
  <li>Don’t check your work. I’d say avoid duplicated data validation, act upon failures.</li>
  <li>Reduce redirecting traffic. This only applies for HTML level, per se. Traffic redirection is key in server configuration and load balancing, especially for inter-service traffic.</li>
  <li>Alleviate temporal constraints.</li>
</ol>

<h2 id="vi-use-caching-aggressively-damn-i-love-it">VI. Use caching aggressively. Damn I love it.</h2>
<ol>
  <li>Leverage CDN.</li>
  <li>Use <code>Expires</code> headers. HTML <a href="https://en.wikipedia.org/wiki/List_of_HTTP_header_fields">headers</a> offer more than you could ever imagine.</li>
  <li>Cache Ajax calls. Use <code>Last-Modified</code>, <code>Cache-Control</code> and <code>Expires</code>.</li>
  <li>Leverage page caches. <a href="https://www.nginx.com/resources/glossary/reverse-proxy-server/">Reverse proxy</a></li>
  <li>Utilize application caches. Cache whatever users mostly request, find the best balance between performance and cost.</li>
  <li>Make use of object caches(aka in-memory cache).</li>
  <li>Put object caches on their own tier. Though I regretly did this mutiple times, caching should never be embedded with crtical path. i.e. whenever caching fails, request should always be properly forwarded to database. Generally, a caching service should sit between api layer and service layer(which operates database commands).</li>
</ol>

<h2 id="vii-learn-from-mistakes">VII. Learn from mistakes</h2>
<ol>
  <li>Don’t rely on QA, period.</li>
  <li>Design for rollback-ready.</li>
</ol>

<h2 id="viii-database-rules">VIII. Database rules</h2>
<ol>
  <li>Be aware of costly relationships. Cross-table queries are expensive.</li>
  <li>Use the right type of database lock.
    <ul>
      <li>Implicit locks. Created automatically by system while performing a transaction.</li>
      <li>Explicit locks. Locks defined by user during the interaction between user and db.</li>
      <li>Row lock locks a row from update, read and write.</li>
      <li>Page locks a row or a group of row.</li>
      <li>Extent locks a group of pages.</li>
      <li>Table lock.</li>
      <li>Database lock.</li>
    </ul>
  </li>
  <li>Don’t use multi-phase commits protocols. <a href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol">2-PC protocol</a> is mainly introduced to distributed process, but before the server returns ack,it hangs PENDING until the transaction is done.</li>
  <li>Try not to use <code>SELECT FOR UPDATE</code>. <code>SELECT</code> is supposed to be fast, but <code>UPDATE</code> locks row and is slow, so it’s drinking soda with a fine goblet.</li>
  <li>Don’t <code>SELECT</code> everthing. Avoid <code>SELECT *</code>, and ask only for what you need.</li>
</ol>

<h2 id="ix-design-for-fault-tolerance-and-graceful-failure">IX. Design for fault tolerance and graceful failure</h2>
<ol>
  <li>Design using fault isolative swimlanes, basically be careful with any comm between swimlanes.
  type of splits:
    <ul>
      <li>Pod. Self-contained sets of functionality containing app servers and persistent storage. Essentially it is equal to a data center.</li>
      <li>Cluster / Pool. A group of servers which have similar functionalities and serve similar customer groups.</li>
      <li>Shard. Horizontal partitions of databases or search engines.</li>
      <li>Swimlane. A fault isolation domain.</li>
    </ul>
  </li>
</ol>

<p>fault isolation principles</p>
<ul>
  <li>Share nothing. However, router, load balancer are acceptable. But database and servers should never be shared.</li>
  <li>No sync calls between swimlanes.</li>
  <li>Limit async calls between swimlanes.</li>
  <li>Use timeouts and wire-on/off with async calls.</li>
</ul>

<ol>
  <li>Never trust single points of failure. Maximize availability through multiple instances.</li>
  <li>Avoid putting systems in series.
    <ul>
      <li><img src="http://www.physics247.com/physics-tutorial/images/seriescircuit.jpg" alt="circuit of series" /></li>
    </ul>
  </li>
  <li>Ensure you can wire-on/off functions. For risky services, it should be able to be switched off during bad moment. Introducing <a href="https://github.com/zendesk/arturo">Zendesk Arturo</a> .</li>
</ol>

<h2 id="x-avoid-or-distribute-state">X. Avoid or distribute state.</h2>
<ol>
  <li>Strive for statelessness. Use stateless implementation (<a href="https://en.wikipedia.org/wiki/Stateless_protocol">what is statelessness?</a>).</li>
  <li>Maintain sessions(cookies) in browser whenever possible. That is, avoid keeping those in servers.</li>
  <li>Make use of a distributed cache for state. Use when cannot store session data in browser. This is because commonly session data or metadata are frequently requested.</li>
</ol>

<h2 id="xi-asynchronous-communication-and-message-buses">XI. Asynchronous communication and message buses.</h2>
<ol>
  <li>Communicate asynchronously as much as possible.</li>
  <li>Ensure your message bus can scale.</li>
  <li>Avoid overcrowding your message bus.</li>
</ol>

<h2 id="xii-miscellaneous-rules">XII. Miscellaneous rules</h2>
<ol>
  <li>Be wary of scaling through 3rd parties.</li>
  <li>Purge, archive, and cost-justify storage.</li>
  <li>Remove businesses intelligence from transaction processing.</li>
  <li>Design your application to be monitored. <del>nagios</del> -&gt; datadog.</li>
  <li>Be competent.</li>
</ol>


</div>

<div id="related">
  <h3>Related Posts</h3>
  <ul class="posts">
    
    <li>
      <span>23 Mar 2017 &raquo;</span> <a href="/2017/03/23/mocha-timeout.html">mocha test exceeds timeout</a>
    </li>
    
    <li>
      <span>23 Feb 2017 &raquo;</span> <a href="/2017/02/23/nginx-add-header.html">nginx's add_header is not working</a>
    </li>
    
    <li>
      <span>07 Mar 2016 &raquo;</span> <a href="/2016/03/07/backfill-systems.html">A Typical Design of Database Backfill System</a>
    </li>
    
  </ul>
</div>


      <div class="footer">
        <div class="disclaimer">
  
  <p>
    The postings on this site are my own and don't necessarily represent my 
    employer’s positions, strategies or opinions.
  </p>
  

  <p>
    © Linyao Li, 2014 &mdash; built with <a href="http://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/swanson/lagom">Lagom theme</a>
  </p>
</div>
      </div>
    </div>
  </div>


</body>
</html>
